<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .admin-container {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      padding: 30px 40px;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      font-family: 'Montserrat', sans-serif;
    }
    h1 {
      margin-bottom: 30px;
      position: relative;
    }
    button.logout-btn {
      position: absolute;
      right: 40px;
      top: 40px;
      background-color: #ff9944;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    table th, table td {
      border: 1px solid #ddd;
      padding: 10px 12px;
      text-align: left;
    }
    table th {
      background-color: #ff9944;
      color: white;
    }
    #leaderboard {
      list-style-type: decimal;
      padding-left: 20px;
      margin-bottom: 15px;
      font-weight: 600;
    }
    button {
      background-color: #ff9944;
      border: none;
      border-radius: 5px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      padding: 10px 15px;
      margin-right: 10px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #e67e22;
    }
    button.reset-btn {
      background-color: crimson;
      margin-top: 10px;
    }
    button.reset-btn:hover {
      background-color: #a00000;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <h1>üìä Admin Dashboard
      <button class="logout-btn" onclick="logoutAdmin()">üö™ Log Out</button>
    </h1>

    <p>Welcome, Admin!</p>

    <section>
      <h2>All Quiz Results</h2>
      <table id="results-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Username</th>
            <th>Score</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section>
      <h2>üèÜ Leaderboard</h2>
      <ol id="leaderboard"></ol>
      <button onclick="exportResults()">üì• Download Results</button>
      <button class="reset-btn" onclick="resetAllData()">üóëÔ∏è Reset All Quiz Data</button>
    </section>
  </div>

  <script>
    // Check if admin logged in
    if (localStorage.getItem("adminLoggedIn") !== "true") {
      alert("You must be logged in as Admin.");
      window.location.href = "index.html";
    }

    const resultsTableBody = document.querySelector("#results-table tbody");
    const leaderboard = document.getElementById("leaderboard");

    function loadResults() {
      const quizData = JSON.parse(localStorage.getItem("quizData")) || [];
      resultsTableBody.innerHTML = "";

      quizData.forEach((entry, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${entry.username}</td>
          <td>${entry.score}</td>
          <td>${entry.date}</td>
        `;
        resultsTableBody.appendChild(tr);
      });

      buildLeaderboard(quizData);
    }

    function buildLeaderboard(data) {
      // Calculate top users by total score
      const scores = {};

      data.forEach(({ username, score }) => {
        scores[username] = (scores[username] || 0) + score;
      });

      // Sort descending by score
      const sorted = Object.entries(scores)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);

      leaderboard.innerHTML = "";
      sorted.forEach(([username, totalScore]) => {
        const li = document.createElement("li");
        li.textContent = `${username} - ${totalScore} pts`;
        leaderboard.appendChild(li);
      });
    }

    function exportResults() {
      const quizData = JSON.parse(localStorage.getItem("quizData")) || [];
      if (quizData.length === 0) {
        alert("No data to export.");
        return;
      }

      const csvHeader = "Username,Score,Date\n";
      const csvRows = quizData.map(({ username, score, date }) => `${username},${score},${date}`);
      const csvContent = csvHeader + csvRows.join("\n");

      const blob = new Blob([csvContent], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "quiz_results.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    function resetAllData() {
      const confirmed = confirm(
        "Are you sure you want to delete all quiz data? This action cannot be undone!"
      );
      if (confirmed) {
        localStorage.removeItem("quizData");
        alert("All quiz data has been deleted.");
        loadResults();
      }
    }

    function logoutAdmin() {
      localStorage.removeItem("adminLoggedIn");
      window.location.href = "index.html";
    }

    loadResults();
  </script>
</body>
</html>
